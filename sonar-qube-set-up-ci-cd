Using SonarCloud (Hosted SonarQube by SonarSource â€” easiest)

If you want a free and fast setup, SonarCloud is the best choice.

1. Create a SonarCloud Account ///////////////////////////////////////////////////////

Go to https://sonarcloud.io

Sign in with your GitHub account

Import your GitHub repository into SonarCloud.

2. Generate a Token  //////////////////////////////////////////////////////////////

In SonarCloud, go to:
My Account â†’ Security â†’ Generate Tokens

Copy the generated token (e.g., SONAR_TOKEN)

3. Add Secret to GitHub  //////////////////////////////////////////////////////////

Go to your GitHub repository â†’ Settings â†’ Secrets and variables â†’ Actions â†’ New repository secret

Add:
SONAR_TOKEN = <your sonarcloud token>


////////////////////////////////////////////////////////////////////////////////////////
# ğŸ§  NEW STEP: SonarCloud Analysis
- name: SonarCloud Code Quality Analysis
  env:
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}   # Needed for PR comments
    SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}     # Your SonarCloud token (youâ€™ll create this)
  run: |
    mvn -B verify sonar:sonar \
      -Dsonar.projectKey=<your_project_key> \
      -Dsonar.organization=<your_org_name> \
      -Dsonar.host.url=https://sonarcloud.io \
      -Dsonar.projectVersion=${{ github.run_number }}

1. name: SonarCloud Code Quality Analysis

This is just a label â€” what youâ€™ll see in GitHub Actions UI when the workflow runs.

âš™ï¸ 2. env: (Environment Variables)
ğŸ”¹ GITHUB_TOKEN

Automatically provided by GitHub Actions.

Allows SonarCloud to post code quality status (like "Passed" or "Failed") back into your pull requests.

You donâ€™t need to create this manually â€” GitHub provides it by default.

ğŸ”¹ SONAR_TOKEN

This is your personal authentication token generated in SonarCloud.

It allows GitHub Actions to authenticate and push your project analysis to your SonarCloud account.

Youâ€™ll store it securely in GitHub Secrets (so itâ€™s not visible in code).

ğŸ§© 3. run: (Actual Command)
Full command:
mvn -B verify sonar:sonar \
  -Dsonar.projectKey=<your_project_key> \
  -Dsonar.organization=<your_org_name> \
  -Dsonar.host.url=https://sonarcloud.io \
  -Dsonar.projectVersion=${{ github.run_number }}

ğŸ”¸ Breakdown:
Part	Purpose
mvn -B	Batch mode (non-interactive) for CI/CD
verify	Runs tests and verifies the build before analysis
sonar:sonar	Executes the Sonar Maven plugin for code analysis
-Dsonar.projectKey	Unique key for your project in SonarCloud
-Dsonar.organization	Your SonarCloud organization name (from your account)
-Dsonar.host.url	Tells Maven where to send analysis results (SonarCloud URL)
-Dsonar.projectVersion=${{ github.run_number }}	Sets the version number to your GitHub workflow run number â€” helps Sonar identify â€œnew codeâ€ between runs


//////////////////////////////////////////////////////////////////////////////////////////////

ğŸª„ Where & How to Create the SonarCloud Token
Step 1ï¸âƒ£ â€” Go to SonarCloud

ğŸ‘‰ https://sonarcloud.io

Sign in using your GitHub account (so it links automatically).

Step 2ï¸âƒ£ â€” Create a Token

Click your profile icon (top right) â†’ My Account

Go to the Security tab

Click â€œGenerate Tokensâ€

Enter a name (e.g. github-actions-token)

Click Generate

Copy the token â€” it will look like:

2b3b0d4a12f8f76c10e60d6cf1e4b8f9d30a1c22

Step 3ï¸âƒ£ â€” Add It to GitHub Secrets

In your repository:

Go to Settings â†’ Secrets and variables â†’ Actions

Click New repository secret

Add:

Name: SONAR_TOKEN
Value: <paste your SonarCloud token here>

Step 4ï¸âƒ£ â€” Get Your Project Key & Organization

Once youâ€™ve imported your repo into SonarCloud (via â€œ+ â†’ Analyze new projectâ€),
youâ€™ll see details like this in the project dashboard:

organization: my-org
projectKey: my-org_my-repo


Use those in your workflow:

-Dsonar.projectKey=my-org_my-repo
-Dsonar.organization=my-org


âœ… Summary Checklist

Task	Where	Example
Create token	SonarCloud â†’ My Account â†’ Security	2b3b0d4a12f8f76c...
Add secret in GitHub	Repo â†’ Settings â†’ Secrets â†’ Actions	SONAR_TOKEN
Project key	Shown in SonarCloud project	my-org_security-project
Organization	Shown in SonarCloud dashboard	my-org


///////////////////////////////////////////////////////////////////////////////////////

Youâ€™ve currently set your â€œNew Code Definitionâ€ to â€œnumber of daysâ€ (e.g., new code since 30 days ago),
and now you want to switch it to â€œPrevious versionâ€ â€” so Sonar marks code changed since your last release/version as new code.

Letâ€™s go step-by-step depending on whether youâ€™re using SonarCloud or self-hosted SonarQube.

ğŸ§© For SonarCloud
ğŸ”§ Step 1: Go to Project Settings

Go to your project dashboard on https://sonarcloud.io

In the left sidebar, click
Project Settings â†’ New Code â†’ Definition of New Code

âš™ï¸ Step 2: Change the â€œNew Code Definitionâ€

Youâ€™ll see a dropdown that says something like:

Define new code as:
   â¦¿ Code changed in the last X days
   â¦¿ Code changed since previous version
   â¦¿ Code changed since previous analysis


âœ… Select:

Code changed since previous version

ğŸ“¦ Step 3: Save Your Change

Click Save (bottom right).
Now, SonarCloud will compare each new analysis against the last version analyzed.

ğŸ§  Step 4: Tell SonarCloud What a â€œVersionâ€ Is

In your CI/CD pipeline, you need to provide a version number when running the scan.

In your GitHub Actions YAML, update your Sonar step to include this line:

-Dsonar.projectVersion=${{ github.run_number }}


So that every new run becomes a new version.
(You can also use your actual release tag or Maven version if you prefer.)

Examples:

1.0.0

1.0.1

${{ github.run_number }} (auto-increments every CI run)

ğŸ§± For Self-Hosted SonarQube

Steps are almost identical:

Step 1:

Go to
Administration â†’ New Code â†’ New Code Definition

Step 2:

Under â€œDefine new code asâ€, select:

Previous version

Step 3:

Click Save.

Step 4:

Pass a project version during analysis:

mvn sonar:sonar -Dsonar.projectVersion=1.1


Next time, run with -Dsonar.projectVersion=1.2, and SonarQube will know that everything since 1.1 is new code.

ğŸ’¡ Quick Reference
Mode	Sonar Behavior
X days	Marks code changed in the last N days as â€œnewâ€
Previous version	Marks code changed since last sonar.projectVersion
Previous analysis	Marks code changed since last pipeline run
âœ… Recommended for CI/CD:

Use:

-Dsonar.projectVersion=${{ github.run_number }}


in your workflow.
That automatically tells Sonar each pipeline run is a new â€œversion,â€ matching how CI/CD pipelines evolve.

Would you like me to show a version of your GitHub Actions file where this new code definition â†’ version logic is fully integrated (so you donâ€™t need to manually set versions)?

///////////////////////////////////////////////////////////////////////////////////////
Define It Directly in GitHub Actions (if you donâ€™t want to touch pom.xml)

If you prefer keeping your pom.xml untouched,
you can keep these definitions inline in your GitHub Actions workflow.

- name: SonarCloud Code Quality Analysis
  env:
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
  run: |
    mvn -B verify sonar:sonar \
      -Dsonar.projectKey=your_org_your-repo \
      -Dsonar.organization=your_org \
      -Dsonar.host.url=https://sonarcloud.io \
      -Dsonar.projectVersion=${{ github.run_number }}


ğŸ“ Replace:

your_org_your-repo â†’ Your actual SonarCloud project key
(usually shown in the SonarCloud dashboard)

your_org â†’ Your SonarCloud organization name

ğŸ” Where to Find These Values in SonarCloud

Go to https://sonarcloud.io

Open your project

Click the gear icon âš™ï¸ â†’ â€œProject Informationâ€

Youâ€™ll see something like:

Project key: my-org_security-project
Organization: my-org


Thatâ€™s what you plug into:

sonar.projectKey = my-org_security-project
sonar.organization = my-org

ğŸ§  Pro Tip

If you have multiple repositories or microservices, you can put these keys in a sonar-project.properties file (alternative to pom.xml):

sonar.projectKey=my-org_security-project
sonar.organization=my-org
sonar.host.url=https://sonarcloud.io


Then your GitHub Action command becomes even simpler:

mvn -B verify sonar:sonar -Dsonar.projectVersion=${{ github.run_number }}

âœ… Recommended Approach for You

Since you already use Maven and GitHub Actions,
Iâ€™d recommend Option 1 â†’ add them in pom.xml.
Itâ€™s cleaner, version-controlled, and works automatically in all environments (local + CI).


//////////////////////////////////////////////////////////////////////////////////
Excellent â€” this is one of the most important parts of integrating SonarQube/SonarCloud securely ğŸ‘

Letâ€™s go step-by-step on where and how to save the token (so GitHub Actions can use it safely without exposing it in your code).

ğŸ§© Youâ€™ll save the Sonar token as a GitHub Secret

Secrets are encrypted environment variables stored in your GitHub repository settings.
They are only accessible inside GitHub Actions workflows â€” never exposed in your code.

ğŸ” Step-by-Step: Add Sonar Token in GitHub
1ï¸âƒ£ Go to your repository on GitHub

Example:

https://github.com/manoj-H-C/security-project

2ï¸âƒ£ Open Settings

In the top bar â†’ click âš™ï¸ Settings

3ï¸âƒ£ Open â€œSecrets and Variables â†’ Actionsâ€

In the left sidebar:

Settings â†’ Secrets and variables â†’ Actions

4ï¸âƒ£ Click â€œNew repository secretâ€

Now youâ€™ll add your tokens here ğŸ‘‡

Add Sonar token:
Name: SONAR_TOKEN
Value: <paste your SonarCloud or SonarQube token>

(Optional) If Youâ€™re Using Self-Hosted SonarQube

Youâ€™ll also add one more:

Name: SONAR_HOST_URL
Value: http://your-sonarqube-server:9000

5ï¸âƒ£ Save

Once you save, GitHub encrypts it immediately â€” no one (even you) can view it again,
but GitHub Actions can use it safely.

ğŸ§  How Itâ€™s Used in Your Workflow

In your .github/workflows/main.yml,
you reference the secret like this:

env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}


When the workflow runs:

GitHub injects the real token values automatically

Theyâ€™re not printed in logs

You never expose sensitive data in the repository

âœ… Optional: Check Itâ€™s Working

After pushing your workflow, go to your GitHub Actions tab â†’
run the pipeline â†’ look for the step:

SonarCloud Code Quality Analysis


If successful, youâ€™ll see a message like:

ANALYSIS SUCCESSFUL, you can browse https://sonarcloud.io/dashboard?id=my-org_security-project

âš ï¸ Important Notes:

Never commit your token to code or pom.xml â€” always use GitHub Secrets.

You can reuse this same secret across all workflows in the same repository.

If you ever regenerate the token in SonarCloud, update it here too.

///////////////////////////////////////////////////////////////////////////
errors

Error:  Failed to execute goal org.sonarsource.scanner.maven:sonar-maven-plugin:4.0.0.4121:sonar (default-cli) on project security: You are running CI analysis while Automatic Analysis is enabled. Please consider disabling one or the other. -> [Help 1]
Error:
Error:  To see the full stack trace of the errors, re-run Maven with the -e switch.
Error:  Re-run Maven using the -X switch to enable full debug logging.
Error:
Error:  For more information about the errors and possible solutions, please read the following articles:
Error:  [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException
Error: Process completed with exit code 1.
You said:
how to generate a pdf report for the analysis


Perfect, Manoj â€” this is actually a very common and simple SonarCloud issue ğŸ¯

The error means your project currently has two types of analyses enabled at the same time, and SonarCloud doesnâ€™t allow that. Letâ€™s fix it in 30 seconds ğŸ‘‡

ğŸ§© The Problem
You are running CI analysis while Automatic Analysis is enabled.
Please consider disabling one or the other.

Whatâ€™s happening:

Automatic Analysis = SonarCloudâ€™s built-in scanner (runs automatically on every push if connected to GitHub).

CI Analysis = your GitHub Actions step (mvn sonar:sonar).

âœ… You only need one of them â€” and since you already have a proper CI/CD pipeline, you should disable Automatic Analysis in SonarCloud.

âœ… The Fix â€” Disable Automatic Analysis

Go to your project on SonarCloud
ğŸ‘‰ https://sonarcloud.io/projects

Open your project (example: security)

In the left sidebar, click â€œAdministration â†’ Analysis Methodâ€

Youâ€™ll see two options:

â˜‘ï¸ Automatic Analysis

â˜ CI-based Analysis

Turn off â€œAutomatic Analysisâ€ (uncheck or toggle it off)

It should now say:

â€œAutomatic Analysis is disabled.â€

ğŸ§  Why You Should Keep CI Analysis

Your CI/CD (GitHub Actions) approach is better because:

It runs after tests and builds â†’ ensures code compiles first.

Itâ€™s versioned with your build â†’ uses ${{ github.run_number }}.

You can analyze PRs and branches exactly when you want.

ğŸš€ After Fixing

Once you disable Automatic Analysis:

Re-run your GitHub Action

The error will disappear

Youâ€™ll see:

[INFO] ANALYSIS SUCCESSFUL
[INFO] More about the report processing at: https://sonarcloud.io/dashboard?id=MHC_security

//////////////////////////////////////////////////////////////////////////////////////////////
to generate report

no way found so far

